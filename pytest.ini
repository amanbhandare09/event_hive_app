# pytest.ini (create this in project root)
"""
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    -v
    --strict-markers
    --cov-report=term-missing
    --cov-branch
markers =
    slow: marks tests as slow
    integration: marks tests as integration tests
"""

# tests/conftest.py (create this file)
import pytest
from app import create_app
from models import db

@pytest.fixture
def app():
    """Create and configure a test app instance."""
    app = create_app()
    app.config.update({
        "TESTING": True,
        "SQLALCHEMY_DATABASE_URI": "sqlite:///:memory:",
        "WTF_CSRF_ENABLED": False
    })
    
    with app.app_context():
        db.create_all()
        yield app
        db.session.remove()
        db.drop_all()

@pytest.fixture
def client(app):
    """Create a test client."""
    return app.test_client()

@pytest.fixture
def runner(app):
    """Create a test CLI runner."""
    return app.test_cli_runner()


# tests/test_app.py (sample test file)
def test_app_exists(app):
    """Test that the app exists."""
    assert app is not None

def test_app_is_testing(app):
    """Test that the app is in testing mode."""
    assert app.config['TESTING']

def test_home_page(client):
    """Test home page loads."""
    response = client.get('/')
    assert response.status_code in [200, 302, 404]  # Adjust based on your routes

def test_health_endpoint(client):
    """Test health check endpoint (if you have one)."""
    response = client.get('/health')
    # Adjust based on whether you have this endpoint
    assert response.status_code in [200, 404]


# tests/test_models.py (sample model tests)
def test_user_model(app):
    """Test User model creation (adjust to your models)."""
    from models.user import User  # Adjust import path
    
    with app.app_context():
        user = User(username='testuser', email='test@example.com')
        db.session.add(user)
        db.session.commit()
        
        assert user.id is not None
        assert user.username == 'testuser'


# tests/test_routes.py (sample route tests)
def test_login_page(client):
    """Test login page loads."""
    response = client.get('/login')
    assert response.status_code in [200, 404]

def test_events_page(client):
    """Test events page."""
    response = client.get('/events')
    assert response.status_code in [200, 302, 404]