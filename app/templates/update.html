{% extends "base.html" %}

{% block title %}Update Event | EventHive{% endblock %}

{% block extra_css %}
<style>
  .form-container {
    max-width: 600px;
    margin: 40px auto;
    background-color: #1a1a1a;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
  }

  h2 {
    text-align: center;
    color: #4CAF50;
    margin-bottom: 25px;
  }

  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
  }

  input, textarea, select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: none;
    border-radius: 6px;
    background-color: #2a2a2a;
    color: #fff;
    font-size: 15px;
  }

  input:focus, textarea:focus, select:focus {
    outline: 2px solid #4CAF50;
  }

  button {
    background-color: #4CAF50;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
    font-size: 16px;
    font-weight: 500;
    transition: background-color 0.3s;
  }

  button:hover {
    background-color: #45a049;
  }

  .message {
    text-align: center;
    margin-top: 15px;
    font-size: 14px;
  }
</style>
{% endblock %}

{% block content %}

<div class="form-container">
  <h2>Update Event</h2>

  <form id="updateEventForm">

    <label for="title">Event Title</label>
    <input type="text" id="title" name="title" value="{{ event.title }}" required>

    <label for="description">Description</label>
    <textarea id="description" name="description" rows="4" required>{{ event.description }}</textarea>

    <label for="date">Date</label>
    <input type="date" id="date" name="date" value="{{ event.date }}" required>

    <label for="start_time">Start Time</label>
    <input type="time" id="starttime" name="starttime"
           value="{{ event.starttime.strftime('%H:%M') if event.starttime else '' }}"
           required>

    <label for="end_time">End Time</label>
    <input type="time" id="endtime" name="endtime"
           value="{{ event.endtime.strftime('%H:%M') if event.endtime else '' }}"
           required>

    <label for="mode">Mode</label>
    <select id="mode" name="mode" required>
      <option value="online"  {% if event.mode.value == 'online' %}selected{% endif %}>Online</option>
      <option value="offline" {% if event.mode.value == 'offline' %}selected{% endif %}>Offline</option>
    </select>

    <label for="venue">Venue</label>
    <input type="text" id="venue" name="venue" value="{{ event.venue }}" required>

    <label for="capacity">Capacity</label>
    <input type="number" id="capacity" name="capacity" min="1" value="{{ event.capacity }}">

    <label for="tags">Tags</label>
    <select id="tags" name="tags" required>
      <option value="Music"      {% if event.tags.value == 'Music' %}selected{% endif %}>Music</option>
      <option value="Sports"     {% if event.tags.value == 'Sports' %}selected{% endif %}>Sports</option>
      <option value="Tech"       {% if event.tags.value == 'Tech' %}selected{% endif %}>Tech</option>
      <option value="Networking" {% if event.tags.value == 'Networking' %}selected{% endif %}>Networking</option>
      <option value="Art"        {% if event.tags.value == 'Art' %}selected{% endif %}>Art</option>
      <option value="Education"  {% if event.tags.value == 'Education' %}selected{% endif %}>Education</option>
    </select>

    <button type="submit">Update Event</button>
  </form>

  <div class="message" id="message"></div>
</div>

<script>
document.getElementById('updateEventForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const data = {
    title: document.getElementById('title').value,
    description: document.getElementById('description').value,
    date: document.getElementById('date').value,
    starttime: document.getElementById('starttime').value,
    endtime: document.getElementById('endtime').value,
    mode: document.getElementById('mode').value,
    venue: document.getElementById('venue').value,
    capacity: document.getElementById('capacity').value,
    tags: document.getElementById('tags').value
  };

  const response = await fetch("{{ url_for('events.update_event', event_id=event.id) }}", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const result = await response.json();
  const messageEl = document.getElementById('message');

  if (response.ok) {
    window.location.href = "{{ url_for('main.profile') }}";
  } else {
    messageEl.style.color = "red";
    messageEl.textContent = "âœ— Failed: " + (result.message || "Error");
  }
});
</script>

{% endblock %}
